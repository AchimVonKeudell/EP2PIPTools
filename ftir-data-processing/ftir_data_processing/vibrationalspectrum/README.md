# Python Library for simulating and fitting IR spectra

Non-equilibrium spectra for:
- CO2
- CO

Equilibrium spectra for:
* Diatomic molecules: CO, NO
* Non-linear triatomic molecules: NO2
* Linear triatomic molecules: N2O
* Linear triatomic molecules (with Fermi resonance): CO2
* Pyramidal tetratomic molecules (symmetric rotors): NH3
* pentatomic molecules (spherical rotors): CH4


## Synopsis
 
This project can simulate infrared absorption spectra using data from the HITRAN or HITEMP databases for gas mixtures in 
thermal-equilibrium.

To achieve this, this project uses a custom database format, that is more efficient than the raw HITRAN data. This 
database is an SQLite database, where the data is split in tables for molecules, isotopologues, structures (which are a
collection of absorption lines belonging to a certain vibrational transition), absorption lines and partition sums.

Transmission spectra are simulated by smartly filtering the full dataset beforehand. For example, many molecules can be
discarded since there are not of interest, isotopologues can be discarded or included based on abundancy, structures and
lines can be included/discarded based on wavelength range and linestrength and so forth. Since the HITRAN databse
includes absorption lines for many millions of absorption lines, a massive speed increase can be achieved by filtering
out many of these lines.

Once the correct lines are selected, these are simulated using so-called simulator objects. These objects use the data
from the custom database, and each of the lines is simulated over a limited wavenumber range by setting threshold values
for:
* The minimum line strength that a line needs to have to be included in the simulation. Lines with a low linestrength
do not significantly contribute to the absorption spectrum under normal conditions, so in this way, many weak lines can
easily be excluded.
* The cutoff cross section of a line, which influences the wavenumber range over which a line has to be 
simulated. The cross section of a line decreases rapidly when moving away from the center of the line. Therefore, 
typically only a few tenths of wavenumbers away from the line center, the cross section of the line is already very 
close to zero. It therefore makes sense to stop simulating a particular line after the cross section goes below a 
 certain value and assume that the cross section is zero in the range where the simulation has not been performed. This
 greatly increases the simulation speed, especially when simulating hundreds of wavenumbers. A similar treshold can be
 set for the transmission, where line simulations are cut off when their transmission goes above for example 0.99.
 
## Motivation 
 
This project is motivated by the scientific need to fit absorption spectra to retrieve number densities, temperatures 
and pressures from the fitting of these spectra. Therefore, a quick and accurate simulation of these spectra must be 
available that can be iterated to find the optimal least-squares fit.
 
## Author 

Original Author: 
Mark Damen (Eindhoven University of Technology, 2016-2020), see [Damen et al 2020 Plasma Sources Sci. Technol. 29 065016](https://iopscience.iop.org/article/10.1088/1361-6595/ab8e50)
 
## Installation 
 
See `ReadMe.md` of the parent directory.


## Workings:
To calculate a spectrum you need a `Simulator` and a `Distribution`, which can be obtained from 
[GetSimulator](GetSimulator.py) and [GetDistibutions](GetDistibution.py), respectively. The former 
obtains the constants - from the SQlite database - required to simulate the spectrum. And the latter, 
defines the type of distribution to describe the population of the ro-vibrational levels.

In [GetSpectrum](GetParameterisedSpectrum.py), the functions `calculate_equilibrium_spectrum` and `calculate_non_equilibrium_spectrum`
use the `Simulator` and `Distribution` to calculate the respective spectrum, together with other required 
conditions. 

In [fit](fit.py), a spectrum could be fitted with the use of `fit_equilibrium_spectrum` and `fit_non_equilibrium-spectrum`, 
which use [lmfit](https://lmfit.github.io/lmfit-py/) python library.

Finally, the respective documentation of the above-mentioned functions should be sufficient to use them.
 
## Example `not up to date!`
An example that simulates the transmission spectrum of a mixture of CO<sub>2</sub> and H<sub>2</sub>O is available in 
the examples folder: [examples/transmission_spectrum.py](examples/transmission_spectrum.py). This examples does the
following:

1. Importing of necessary Python objects to load the HITRAN data and simulate the spectrum.
2. Load an SQLite database file, containing structured HITRAN data for all absorption lines and the repository objects
to access this data (the database file can be generated by running [generate_database.py](generate_database.py) if not
present yet).
3. Retrieve simulator objects for molecules, isotopologues, vibrational structures and absorption lines based on filters
 that filter out any line data that is not of interest for simulation of the spectra. This thus filters out any 
 molecules that are not CO<sub>2</sub> or H<sub>2</sub>O, isotopologues that have a very low abundancy, structures that 
 don't have a high enough linestrength, lines that aren't in the right wavenumber range, and so forth.
4. Define the measurement conditions such as temperature, pressure and absorption path length.
5. Create a spectrum object to hold the transmission of the gas mixture, and add the transmission data to this object.
In this examples, this is done per molecule, to be able to show the transmission on a per-molecule-basis.

## Database Configuration 
The project makes use of an SQLite database structure to efficiently store and index data on molecules, isotopologues, 
absorption structures and data on line-by-line parameters. These parameters are stored in `hitran_database.sqlite`. 
This database is filled using the HITRAN or HITEMP database. This database file is following the routine described in 
the parent directory.

## API Reference 
 
No API is available yet. 
